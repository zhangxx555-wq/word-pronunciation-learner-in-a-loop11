<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å•è¯å‘éŸ³å­¦ä¹ å™¨ - å®Œæ•´ç‰ˆ</title>
    
    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 15px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .input-group {
            margin-bottom: 18px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
            font-size: 15px;
        }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        /* ç§»åŠ¨ç«¯è¾“å…¥ä¼˜åŒ– */
        @media (max-width: 768px) {
            input, select {
                font-size: 18px;
                padding: 16px;
            }
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            margin: 8px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-test {
            background: #9b59b6;
        }
        
        .btn-test:hover {
            background: #8e44ad;
        }
        
        .btn-import {
            background: #FF9800;
        }
        
        .btn-backup {
            background: #9C27B0;
        }
        
        .btn-sequence {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
            margin-top: 15px;
        }
        
        .btn-pause {
            background: #f39c12;
        }
        
        .btn-stop {
            background: #e74c3c;
        }
        
        .table-section {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .table-header {
            background: #2c3e50;
            color: white;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        thead {
            background: #ecf0f1;
        }
        
        th {
            padding: 16px 12px;
            text-align: left;
            color: #2c3e50;
            font-weight: bold;
            border-bottom: 2px solid #bdc3c7;
        }
        
        td {
            padding: 16px 12px;
            border-bottom: 1px solid #ecf0f1;
            vertical-align: top;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .word-cell {
            color: #3498db;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            padding: 8px 0;
        }
        
        .word-cell:hover {
            text-decoration: underline;
        }
        
        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            margin: 0 6px;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            background: #f1f1f1;
            transform: scale(1.1);
        }
        
        .play-btn {
            color: #3498db;
        }
        
        .sequence-btn {
            color: #00b09b;
        }
        
        .delete-btn {
            color: #95a5a6;
        }
        
        .status-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #2ecc71;
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            z-index: 1000;
            font-size: 15px;
            text-align: center;
        }
        
        .sequence-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #e3f2fd;
        }
        
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .current-playing {
            background-color: #e8f4fc !important;
            animation: highlight 2s ease-in-out;
        }
        
        @keyframes highlight {
            0% { background-color: #e8f4fc; }
            50% { background-color: #d4eaf7; }
            100% { background-color: #e8f4fc; }
        }
        
        .empty-table {
            text-align: center;
            padding: 50px 20px;
            color: #95a5a6;
        }
        
        .empty-table i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .control-buttons {
                flex-direction: column;
            }
            
            .btn {
                min-height: 50px;
            }
        }
        
        .settings-group {
            margin-top: 20px;
            padding: 15px;
            background: #f0f7ff;
            border-radius: 10px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }
        
        .setting-item input[type="number"] {
            width: 60px;
            padding: 8px;
            text-align: center;
        }
        
        .setting-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
    </style>
    
    <!-- Font Awesomeå›¾æ ‡ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container" id="mainContent">
        <header>
            <h1><i class="fas fa-volume-up"></i> å•è¯å‘éŸ³å­¦ä¹ å™¨</h1>
            <p class="subtitle">è¾“å…¥å•è¯ â†’ è‡ªåŠ¨å‘éŸ³ â†’ é¡ºåºå­¦ä¹  | GitHub Pagesç‰ˆ</p>
        </header>
        
        <div class="main-content">
            <!-- å·¦ä¾§ï¼šè¾“å…¥å’Œæ§åˆ¶åŒºåŸŸ -->
            <div class="input-section">
                <h2><i class="fas fa-plus-circle"></i> æ·»åŠ æ–°å•è¯</h2>
                
                <div class="input-group">
                    <label for="wordInput"><i class="fas fa-font"></i> å•è¯/å¥å­</label>
                    <input type="text" id="wordInput" placeholder="è¾“å…¥ä½ æƒ³å­¦ä¹ çš„å•è¯æˆ–å¥å­" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label for="meaningInput"><i class="fas fa-language"></i> é‡Šä¹‰ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="meaningInput" placeholder="ä¾‹å¦‚ï¼šè‹¹æœ" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label for="languageSelect"><i class="fas fa-globe"></i> é€‰æ‹©è¯­è¨€</label>
                    <select id="languageSelect">
                        <option value="en-US">è‹±è¯­ (ç¾å¼)</option>
                        <option value="en-GB">è‹±è¯­ (è‹±å¼)</option>
                        <option value="zh-CN">ä¸­æ–‡ (æ™®é€šè¯)</option>
                        <option value="ja-JP">æ—¥è¯­</option>
                        <option value="ko-KR">éŸ©è¯­</option>
                        <option value="fr-FR">æ³•è¯­</option>
                        <option value="de-DE">å¾·è¯­</option>
                    </select>
                </div>
                
                <button class="btn btn-success" onclick="addWord()">
                    <i class="fas fa-plus"></i> æ·»åŠ åˆ°å•è¯è¡¨
                </button>
                
                <button class="btn btn-test" onclick="testPronunciation()">
                    <i class="fas fa-play"></i> è¯•å¬å‘éŸ³
                </button>
                
                <button class="btn btn-danger" onclick="clearAllWords()">
                    <i class="fas fa-trash"></i> æ¸…ç©ºå•è¯è¡¨
                </button>
                
                <button class="btn btn-import" onclick="importData()">
                    <i class="fas fa-file-import"></i> å¯¼å…¥æ•°æ®
                </button>
                
                <button class="btn btn-backup" onclick="exportData()">
                    <i class="fas fa-download"></i> å¯¼å‡ºæ•°æ®
                </button>
                
                <!-- é¡ºåºæ’­æ”¾æ§åˆ¶åŒºåŸŸ -->
                <div class="sequence-controls">
                    <h3><i class="fas fa-list-ol"></i> é¡ºåºæ’­æ”¾æ§åˆ¶</h3>
                    
                    <div id="progressContainer" class="progress-container" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="progress-info">
                            <span id="currentWordInfo">å‡†å¤‡ä¸­...</span>
                            <span id="progressText">0/0</span>
                        </div>
                    </div>
                    
                    <div class="control-buttons">
                        <button class="btn btn-sequence" onclick="startSequencePlay()" id="startBtn">
                            <i class="fas fa-play-circle"></i> å¼€å§‹é¡ºåºæ’­æ”¾
                        </button>
                        
                        <button class="btn btn-pause" onclick="togglePause()" id="pauseBtn" style="display: none;">
                            <i class="fas fa-pause"></i> æš‚åœ
                        </button>
                        
                        <button class="btn btn-stop" onclick="stopSequencePlay()" id="stopBtn" style="display: none;">
                            <i class="fas fa-stop"></i> åœæ­¢
                        </button>
                    </div>
                    
                    <!-- æ’­æ”¾è®¾ç½® -->
                    <div class="settings-group">
                        <h4><i class="fas fa-cog"></i> æ’­æ”¾è®¾ç½®</h4>
                        
                        <div class="setting-item">
                            <span>è‡ªåŠ¨æ’­æ”¾é‡Šä¹‰ï¼š</span>
                            <input type="checkbox" id="autoPlayMeaning" checked>
                        </div>
                        
                        <div class="setting-item">
                            <span>æ’­æ”¾é—´éš”ï¼ˆç§’ï¼‰ï¼š</span>
                            <input type="number" id="playInterval" value="2" min="1" max="5">
                        </div>
                        
                        <div class="setting-item">
                            <span>æ’­æ”¾é€Ÿåº¦ï¼š</span>
                            <select id="playSpeed">
                                <option value="0.7">æ…¢é€Ÿ</option>
                                <option value="0.8">ç¨æ…¢</option>
                                <option value="1.0" selected>æ­£å¸¸</option>
                                <option value="1.2">ç¨å¿«</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- å³ä¾§ï¼šå•è¯è¡¨æ ¼åŒºåŸŸ -->
            <div class="table-section">
                <div class="table-header">
                    <h2><i class="fas fa-list"></i> å•è¯è¡¨ (<span id="wordCount">0</span>ä¸ªå•è¯)</h2>
                    <button class="btn btn-sequence" onclick="startSequencePlay()" style="padding: 8px 16px; width: auto;">
                        <i class="fas fa-play-circle"></i> é¡ºåºæ’­æ”¾
                    </button>
                </div>
                
                <div style="overflow-x: auto;">
                    <table id="wordTable">
                        <thead>
                            <tr>
                                <th width="30%">å•è¯</th>
                                <th width="35%">é‡Šä¹‰</th>
                                <th width="35%">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="wordList">
                            <!-- å•è¯ä¼šåŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
                        </tbody>
                    </table>
                    
                    <div id="emptyMessage" class="empty-table">
                        <i class="fas fa-book-open"></i>
                        <h3>å•è¯è¡¨æ˜¯ç©ºçš„</h3>
                        <p>è¯·åœ¨å·¦ä¾§æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªå•è¯</p>
                        <button class="btn btn-success" onclick="addExampleWords()" style="width: auto; margin-top: 15px;">
                            <i class="fas fa-magic"></i> æ·»åŠ ç¤ºä¾‹å•è¯
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="status-bar" id="statusBar"></div>

    <script>
        // ==================== æ ¸å¿ƒå˜é‡ ====================
        let wordList = [];
        let currentPlayIndex = 0;
        let isPlaying = false;
        let isPaused = false;
        const STORAGE_KEY = 'word_pronunciation_learner_v2';
        
        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            loadWords();
            showStatus('é¡µé¢åŠ è½½å®Œæˆï¼', 'success');
            
            // åŠ è½½è®¾ç½®
            const settings = JSON.parse(localStorage.getItem('word_learner_settings') || '{}');
            if (settings.interval) document.getElementById('playInterval').value = settings.interval;
            if (settings.speed) document.getElementById('playSpeed').value = settings.speed;
            if (settings.autoPlayMeaning !== undefined) {
                document.getElementById('autoPlayMeaning').checked = settings.autoPlayMeaning;
            }
            
            // è¾“å…¥æ¡†å›è½¦å¿«æ·é”®
            document.getElementById('wordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (e.ctrlKey) {
                        addWord();
                    } else {
                        testPronunciation();
                    }
                }
            });
        });
        
        // ==================== å•è¯ç®¡ç† ====================
        function addWord() {
            const wordInput = document.getElementById('wordInput');
            const meaningInput = document.getElementById('meaningInput');
            const languageSelect = document.getElementById('languageSelect');
            
            const word = wordInput.value.trim();
            const meaning = meaningInput.value.trim();
            const language = languageSelect.value;
            
            if (!word) {
                showStatus('è¯·è¾“å…¥å•è¯ï¼', 'error');
                wordInput.focus();
                return;
            }
            
            const newWord = {
                id: Date.now() + Math.random(),
                word: word,
                meaning: meaning || 'â€”',
                language: language,
                date: new Date().toLocaleDateString('zh-CN')
            };
            
            wordList.push(newWord);
            renderWordTable();
            
            // æ¸…ç©ºè¾“å…¥æ¡†
            wordInput.value = '';
            meaningInput.value = '';
            wordInput.focus();
            
            showStatus('âœ… å•è¯å·²æ·»åŠ ï¼', 'success');
            saveWords();
        }
        
        function renderWordTable() {
            const tbody = document.getElementById('wordList');
            const emptyMessage = document.getElementById('emptyMessage');
            
            if (wordList.length === 0) {
                tbody.innerHTML = '';
                emptyMessage.style.display = 'block';
                updateWordCount();
                return;
            }
            
            emptyMessage.style.display = 'none';
            tbody.innerHTML = '';
            
            wordList.forEach((word, index) => {
                const row = document.createElement('tr');
                row.id = `word-row-${word.id}`;
                
                // å•è¯åˆ—
                const wordCell = document.createElement('td');
                wordCell.innerHTML = `
                    <div class="word-cell" onclick="speakWord('${word.word}', '${word.language}')">
                        <i class="fas fa-volume-up"></i> ${word.word}
                    </div>
                    <div style="font-size: 12px; color: #95a5a6; margin-top: 5px;">
                        ${word.language} | ${word.date}
                    </div>
                `;
                
                // é‡Šä¹‰åˆ—
                const meaningCell = document.createElement('td');
                meaningCell.textContent = word.meaning;
                
                // æ“ä½œåˆ—
                const actionCell = document.createElement('td');
                actionCell.innerHTML = `
                    <button class="action-btn play-btn" onclick="speakWord('${word.word.replace(/'/g, "\\'")}', '${word.language}')" title="å‘éŸ³">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="action-btn sequence-btn" onclick="playWordWithMeaning(${index})" title="æ’­æ”¾å•è¯+é‡Šä¹‰">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="action-btn delete-btn" onclick="deleteWord(${word.id})" title="åˆ é™¤">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                row.appendChild(wordCell);
                row.appendChild(meaningCell);
                row.appendChild(actionCell);
                tbody.appendChild(row);
            });
            
            updateWordCount();
        }
        
        function deleteWord(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå•è¯å—ï¼Ÿ')) {
                const index = wordList.findIndex(w => w.id === id);
                if (index !== -1) {
                    wordList.splice(index, 1);
                    renderWordTable();
                    saveWords();
                    showStatus('å•è¯å·²åˆ é™¤', 'info');
                }
            }
        }
        
        function clearAllWords() {
            if (wordList.length === 0) {
                showStatus('å•è¯è¡¨å·²ç»æ˜¯ç©ºçš„', 'info');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ ${wordList.length} ä¸ªå•è¯å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                if (isPlaying) stopSequencePlay();
                wordList = [];
                renderWordTable();
                saveWords();
                showStatus('å·²æ¸…ç©ºæ‰€æœ‰å•è¯', 'info');
            }
        }
        
        function updateWordCount() {
            document.getElementById('wordCount').textContent = wordList.length;
        }
        
        // ==================== å‘éŸ³åŠŸèƒ½ ====================
        function speakWord(text, language) {
            if (!('speechSynthesis' in window)) {
                showStatus('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åˆæˆ', 'error');
                return;
            }
            
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = language;
            utterance.rate = parseFloat(document.getElementById('playSpeed').value);
            utterance.volume = 1.0;
            
            speechSynthesis.speak(utterance);
        }
        
        function testPronunciation() {
            const wordInput = document.getElementById('wordInput');
            const languageSelect = document.getElementById('languageSelect');
            
            const word = wordInput.value.trim();
            if (!word) {
                showStatus('è¯·è¾“å…¥è¦è¯•å¬çš„å•è¯', 'error');
                return;
            }
            
            speakWord(word, languageSelect.value);
        }
        
        // ==================== é¡ºåºæ’­æ”¾åŠŸèƒ½ ====================
        function startSequencePlay() {
            if (wordList.length === 0) {
                showStatus('å•è¯è¡¨æ˜¯ç©ºçš„ï¼Œè¯·å…ˆæ·»åŠ å•è¯', 'error');
                return;
            }
            
            if (isPlaying && !isPaused) {
                showStatus('å·²ç»åœ¨æ’­æ”¾ä¸­', 'info');
                return;
            }
            
            if (isPaused) {
                // æ¢å¤æ’­æ”¾
                isPaused = false;
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                showStatus('ç»§ç»­æ’­æ”¾...', 'info');
                playNextWord();
                return;
            }
            
            // å¼€å§‹æ–°çš„é¡ºåºæ’­æ”¾
            isPlaying = true;
            isPaused = false;
            currentPlayIndex = 0;
            
            // ä¿å­˜è®¾ç½®
            saveSettings();
            
            // æ›´æ–°ç•Œé¢
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('pauseBtn').style.display = 'flex';
            document.getElementById('stopBtn').style.display = 'flex';
            document.getElementById('progressContainer').style.display = 'block';
            
            // æ¸…é™¤é«˜äº®
            clearHighlights();
            
            // å¼€å§‹æ’­æ”¾
            playNextWord();
        }
        
        function playNextWord() {
            if (!isPlaying || isPaused || currentPlayIndex >= wordList.length) {
                if (currentPlayIndex >= wordList.length) {
                    // æ’­æ”¾å®Œæˆ
                    stopSequencePlay();
                    showStatus('ğŸ‰ é¡ºåºæ’­æ”¾å®Œæˆï¼', 'success');
                }
                return;
            }
            
            const word = wordList[currentPlayIndex];
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            // é«˜äº®å½“å‰å•è¯
            highlightCurrentWord(word.id);
            
            // æ’­æ”¾å½“å‰å•è¯
            playCurrentWord(word);
            
            currentPlayIndex++;
        }
        
        function playCurrentWord(word) {
            const autoPlayMeaning = document.getElementById('autoPlayMeaning').checked;
            
            // æ’­æ”¾å•è¯
            speakWord(word.word, word.language);
            
            // ç›‘å¬æ’­æ”¾å®Œæˆ
            let utteranceCompleted = false;
            
            // æ£€æŸ¥å‘éŸ³çŠ¶æ€
            const checkInterval = setInterval(() => {
                if (!speechSynthesis.speaking && utteranceCompleted) {
                    clearInterval(checkInterval);
                    
                    if (autoPlayMeaning && word.meaning !== 'â€”') {
                        // æ’­æ”¾é‡Šä¹‰
                        setTimeout(() => {
                            speakWord(word.meaning, 'zh-CN');
                            
                            // ç›‘å¬é‡Šä¹‰æ’­æ”¾å®Œæˆ
                            const checkMeaningInterval = setInterval(() => {
                                if (!speechSynthesis.speaking) {
                                    clearInterval(checkMeaningInterval);
                                    // ç»§ç»­ä¸‹ä¸€ä¸ªå•è¯
                                    setTimeout(() => {
                                        playNextWord();
                                    }, getPlayInterval());
                                }
                            }, 100);
                        }, 500);
                    } else {
                        // ç»§ç»­ä¸‹ä¸€ä¸ªå•è¯
                        setTimeout(() => {
                            playNextWord();
                        }, getPlayInterval());
                    }
                }
            }, 100);
            
            // è®¾ç½®è¶…æ—¶é˜²æ­¢å¡ä½
            setTimeout(() => {
                if (!utteranceCompleted) {
                    utteranceCompleted = true;
                }
            }, 5000);
            
            // æ ‡è®°æ’­æ”¾å¼€å§‹
            setTimeout(() => {
                utteranceCompleted = true;
            }, 300);
        }
        
        function playWordWithMeaning(index) {
            if (index < 0 || index >= wordList.length) return;
            
            const word = wordList[index];
            speakWord(word.word, word.language);
            
            setTimeout(() => {
                if (!speechSynthesis.speaking && word.meaning !== 'â€”') {
                    speakWord(word.meaning, 'zh-CN');
                }
            }, 1000);
        }
        
        function togglePause() {
            if (!isPlaying) return;
            
            isPaused = !isPaused;
            
            if (isPaused) {
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-play"></i> ç»§ç»­';
                showStatus('æ’­æ”¾å·²æš‚åœ', 'info');
                
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }
            } else {
                document.getElementById('pauseBtn').innerHTML = '<i class="fas fa-pause"></i> æš‚åœ';
                showStatus('ç»§ç»­æ’­æ”¾...', 'info');
                playNextWord();
            }
        }
        
        function stopSequencePlay() {
            isPlaying = false;
            isPaused = false;
            currentPlayIndex = 0;
            
            // åœæ­¢å‘éŸ³
            if (speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }
            
            // æ¢å¤ç•Œé¢
            document.getElementById('startBtn').style.display = 'flex';
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            
            // æ¸…é™¤é«˜äº®
            clearHighlights();
            
            // é‡ç½®è¿›åº¦
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('currentWordInfo').textContent = 'å‡†å¤‡ä¸­...';
            document.getElementById('progressText').textContent = '0/0';
            
            showStatus('é¡ºåºæ’­æ”¾å·²åœæ­¢', 'info');
        }
        
        function updateProgress() {
            const progress = (currentPlayIndex / wordList.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            
            if (currentPlayIndex < wordList.length) {
                const word = wordList[currentPlayIndex];
                document.getElementById('currentWordInfo').textContent = 
                    `${word.word} (${word.language})`;
            }
            
            document.getElementById('progressText').textContent = 
                `${currentPlayIndex + 1}/${wordList.length}`;
        }
        
        function highlightCurrentWord(id) {
            clearHighlights();
            const row = document.getElementById(`word-row-${id}`);
            if (row) {
                row.classList.add('current-playing');
                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
        
        function clearHighlights() {
            document.querySelectorAll('tr').forEach(row => {
                row.classList.remove('current-playing');
            });
        }
        
        function getPlayInterval() {
            return parseInt(document.getElementById('playInterval').value) * 1000;
        }
        
        // ==================== æ•°æ®å­˜å‚¨ ====================
        function saveWords() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(wordList));
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
            }
        }
        
        function loadWords() {
            try {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    wordList = JSON.parse(saved);
                    renderWordTable();
                }
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                wordList = [];
            }
        }
        
        function saveSettings() {
            const settings = {
                interval: document.getElementById('playInterval').value,
                speed: document.getElementById('playSpeed').value,
                autoPlayMeaning: document.getElementById('autoPlayMeaning').checked,
                savedAt: new Date().toISOString()
            };
            localStorage.setItem('word_learner_settings', JSON.stringify(settings));
        }
        
        // ==================== å¯¼å…¥å¯¼å‡º ====================
        function exportData() {
            if (wordList.length === 0) {
                showStatus('æ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡º', 'error');
                return;
            }
            
            const data = {
                version: '2.0',
                exportedAt: new Date().toISOString(),
                wordCount: wordList.length,
                words: wordList
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å•è¯è¡¨_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            showStatus('âœ… æ•°æ®å·²å¯¼å‡º', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        let importedWords = [];
                        
                        if (Array.isArray(importedData)) {
                            importedWords = importedData;
                        } else if (importedData.words && Array.isArray(importedData.words)) {
                            importedWords = importedData.words;
                        }
                        
                        if (importedWords.length === 0) {
                            throw new Error('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„å•è¯æ•°æ®');
                        }
                        
                        const shouldMerge = wordList.length > 0 && 
                            confirm(`æ‰¾åˆ° ${importedWords.length} ä¸ªå•è¯\n\né€‰æ‹©ï¼š\nç¡®å®š = è¦†ç›–ç°æœ‰æ•°æ®\nå–æ¶ˆ = åˆå¹¶åˆ°ç°æœ‰æ•°æ®`);
                        
                        if (shouldMerge) {
                            // åˆå¹¶
                            const existingWords = new Set(wordList.map(w => w.word.toLowerCase()));
                            const newWords = importedWords.filter(w => 
                                w.word && !existingWords.has(w.word.toLowerCase())
                            );
                            wordList = wordList.concat(newWords);
                            showStatus(`âœ… å·²åˆå¹¶ ${newWords.length} ä¸ªæ–°å•è¯`, 'success');
                        } else {
                            // è¦†ç›–
                            wordList = importedWords;
                            showStatus(`âœ… å·²å¯¼å…¥ ${wordList.length} ä¸ªå•è¯`, 'success');
                        }
                        
                        saveWords();
                        renderWordTable();
                        
                    } catch (error) {
                        showStatus(`å¯¼å…¥å¤±è´¥: ${error.message}`, 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // ==================== ç¤ºä¾‹æ•°æ® ====================
        function addExampleWords() {
            const examples = [
                { word: 'Hello', meaning: 'ä½ å¥½', language: 'en-US' },
                { word: 'Good morning', meaning: 'æ—©ä¸Šå¥½', language: 'en-US' },
                { word: 'Thank you', meaning: 'è°¢è°¢ä½ ', language: 'en-US' },
                { word: 'ä½ å¥½', meaning: 'Hello', language: 'zh-CN' },
                { word: 'è°¢è°¢', meaning: 'Thank you', language: 'zh-CN' },
                { word: 'ã“ã‚“ã«ã¡ã¯', meaning: 'ä½ å¥½', language: 'ja-JP' }
            ];
            
            examples.forEach(example => {
                wordList.push({
                    id: Date.now() + Math.random(),
                    word: example.word,
                    meaning: example.meaning,
                    language: example.language,
                    date: new Date().toLocaleDateString('zh-CN')
                });
            });
            
            renderWordTable();
            saveWords();
            showStatus('å·²æ·»åŠ ç¤ºä¾‹å•è¯ï¼Œç‚¹å‡»è¯•å¬ï¼', 'success');
        }
        
        // ==================== å·¥å…·å‡½æ•° ====================
        function showStatus(message, type = 'info') {
            const statusBar = document.getElementById('statusBar');
            
            statusBar.textContent = message;
            statusBar.style.display = 'block';
            
            const colors = {
                success: '#2ecc71',
                error: '#e74c3c',
                info: '#3498db',
                warning: '#f39c12'
            };
            statusBar.style.background = colors[type] || colors.info;
            
            setTimeout(() => {
                statusBar.style.display = 'none';
            }, 3000);
        }
        
        // ==================== é”®ç›˜å¿«æ·é”® ====================
        document.addEventListener('keydown', function(e) {
            // ç©ºæ ¼é”®åœæ­¢å‘éŸ³
            if (e.key === ' ' && !e.target.matches('input, textarea, button')) {
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                    showStatus('å‘éŸ³å·²åœæ­¢', 'info');
                }
                e.preventDefault();
            }
            
            // Ctrl+P å¼€å§‹é¡ºåºæ’­æ”¾
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                startSequencePlay();
            }
            
            // Ctrl+S åœæ­¢é¡ºåºæ’­æ”¾
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                stopSequencePlay();
            }
            
            // Ctrl+E å¯¼å‡ºæ•°æ®
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                exportData();
            }
        });
    </script>
</body>
</html>